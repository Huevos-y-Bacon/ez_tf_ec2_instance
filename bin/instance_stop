#!/usr/bin/env bash
# shellcheck disable=1091

source colours 2>/dev/null

CWD=$(basename "$(pwd)")
if [ "$CWD" == "bin" ]; then
    echo "${RED}Error: Script cannot be executed directly from inside ${CWD}.${NORM}"
    exit 1
fi

id=$(terraform output -raw instance_id)
name=$(terraform output -raw instance_name)
echo "Stopping instance ez_tf_ec2_instance:
  Name       : ${name}
  InstanceId : ${id}
"
aws ec2 stop-instances --instance-ids "${id}" --out yaml
aws ec2 wait instance-stopped --instance-ids "${id}" && echo -e "\nInstance stopped"
